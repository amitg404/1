<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div id="container" class="w-full max-w-lg text-center">
        <h1 id="title" class="text-3xl font-bold mb-4">Loading...</h1>
        <p class="text-gray-400 mb-8">Your video is ready. Use the button below to play it in an external application like VLC for the best quality.</p>
        
        <div id="playButtonContainer">
            <!-- The link will be set by JavaScript -->
            <a id="playLink" href="#" class="block w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-6 rounded-lg text-xl transition-transform transform hover:scale-105">
                Play in External App
            </a>
            <p class="text-xs text-gray-500 mt-2">On mobile, this should prompt you to choose a player. On desktop, this may download the file.</p>
        </div>

        <div id="nextButtonContainer" class="mt-6 hidden">
             <!-- The link will be set by JavaScript -->
            <a id="nextLink" href="#" class="block w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105">
                Next Episode
            </a>
        </div>
    </div>

    <script>
        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            const driveId = params.get('driveId');
            const title = params.get('title');
            const accessToken = params.get('accessToken');
            
            const nextDriveId = params.get('nextDriveId');
            const nextTitle = params.get('nextTitle');

            if (driveId && title && accessToken) {
                document.getElementById('title').textContent = title;

                // This is the direct, full-quality download link that external players need.
                // It requires the access token to authenticate.
                const directPlayUrl = `https://www.googleapis.com/drive/v3/files/${driveId}?alt=media&access_token=${accessToken}`;
                
                document.getElementById('playLink').href = directPlayUrl;

                if (nextDriveId && nextTitle) {
                    const nextButtonContainer = document.getElementById('nextButtonContainer');
                    const nextLink = document.getElementById('nextLink');
                    
                    // Re-create the URL for the next episode's launchpad page
                    const nextParams = new URLSearchParams();
                    nextParams.set('driveId', nextDriveId);
                    nextParams.set('title', nextTitle);
                    nextParams.set('accessToken', accessToken);
                    // We need to pass the rest of the series info along too
                    nextParams.set('seriesId', params.get('seriesId'));
                    
                    nextLink.href = `player.html?${nextParams.toString()}`;
                    nextLink.textContent = `Next: ${nextTitle}`;
                    nextButtonContainer.classList.remove('hidden');
                }

            } else {
                document.getElementById('title').textContent = 'Error';
                document.getElementById('container').innerHTML += '<p class="text-red-500 mt-4">Could not load video. Necessary information is missing.</p>';
            }
        };
    </script>
</body>
</html>

